<div
  class="bg-background-light dark:bg-results-background-dark text-slate-900 dark:text-slate-50 font-display min-h-screen flex flex-col overflow-hidden relative selection:bg-primary selection:text-white"
>
  @if (questions().length) {
    <main class="flex-1 overflow-y-auto pb-24 relative">
      <div class="w-full md:w-[70%] md:mx-auto">
        <div class="sticky top-0 z-10 bg-background-light/95 dark:bg-results-background-dark/95 backdrop-blur-sm pt-8 pb-3 px-4 md:px-0 border-b border-transparent dark:border-surface-highlight/50">
          <div class="flex items-center justify-between mb-2">
            <h1 class="text-3xl font-bold tracking-tight dark:text-white">{{ 'results.title' | translate }}</h1>
            <div class="flex items-center gap-2">
              <button
                type="button"
                class="h-10 px-4 rounded-full border border-slate-300 dark:border-surface-highlight bg-white/90 dark:bg-surface-dark text-slate-700 dark:text-slate-200 text-xs font-medium hover:bg-white dark:hover:bg-surface-highlight transition-colors whitespace-nowrap"
                (click)="backToSetup()"
              >
                {{ 'actions.back_to_setup' | translate }}
              </button>
            </div>
          </div>
          <p class="text-sm text-slate-500 dark:text-slate-400 mb-4">
            {{ 'results.score_line' | translate: { correct: results().correct, total: results().total, percent: results().scorePercent } }}
          </p>
          <div class="flex p-1 bg-slate-200 dark:bg-surface-highlight rounded-lg">
            <button type="button" [class]="filterButtonClasses('all')" (click)="setFilter('all')">{{ 'actions.all' | translate }}</button>
            <button type="button" [class]="filterButtonClasses('incorrect')" (click)="setFilter('incorrect')">{{ 'actions.incorrect' | translate }}</button>
            <button type="button" [class]="filterButtonClasses('unanswered')" (click)="setFilter('unanswered')">{{ 'actions.unanswered' | translate }}</button>
          </div>
        </div>

        <div class="px-4 md:px-0 py-4 space-y-4">
          @for (question of filteredQuestions(); track question.id) {
            <div [class]="questionCardClasses(question)">
              <div class="p-4 flex flex-col gap-3">
                <div class="flex items-center justify-between">
                  <div class="flex items-center gap-2">
                    <span [class]="questionStatusIconClasses(question)">
                      <span class="material-symbols-outlined text-sm font-bold">{{ questionStatusIcon(question) }}</span>
                    </span>
                    <h3 [class]="questionTitleClasses(question)">{{ 'results.question_label' | translate: { number: questionNumber(question.id) } }}</h3>
                  </div>
                  <span class="text-xs font-medium text-slate-400">{{ topicName(question.topicId) }}</span>
                </div>

                <p class="text-base font-medium leading-relaxed dark:text-slate-200">{{ question.text }}</p>

                <div class="flex flex-col gap-2 mt-1">
                  @for (option of question.options; track option.id) {
                    <div [class]="optionRowClasses(question, option)">
                      @if (
                        (isIncorrect(question) && (isSelectedOption(question, option) || isCorrectOption(question, option))) ||
                        (isCorrect(question) && isCorrectOption(question, option))
                      ) {
                        <div
                          class="absolute left-0 top-0 bottom-0 w-1"
                          [class.bg-error]="isIncorrect(question) && isSelectedOption(question, option)"
                          [class.bg-success]="isCorrectOption(question, option) && !isUnanswered(question)"
                        ></div>
                      }

                      <div class="flex items-center gap-3 w-full min-w-0" [class.pl-1]="isCorrectOption(question, option) || isSelectedOption(question, option)">
                        <div [class]="optionIndicatorClasses(question, option)">
                          @if (isIncorrect(question) && isSelectedOption(question, option)) {
                            <div class="w-2.5 h-2.5 rounded-full bg-error"></div>
                          } @else if (isCorrectOption(question, option) && !isUnanswered(question)) {
                            <span class="material-symbols-outlined text-[14px] font-bold" [class.text-success]="!isCorrect(question)" [class.text-white]="isCorrect(question)">check</span>
                          } @else if (isUnanswered(question) && isCorrectOption(question, option)) {
                            <span class="material-symbols-outlined text-primary text-[14px] font-bold">check</span>
                          }
                        </div>
                        <span [class]="optionTextClasses(question, option)">{{ option.text }}</span>
                      </div>

                      @if (optionMarker(question, option) === 'close') {
                        <span class="material-symbols-outlined text-error text-xl">close</span>
                      } @else if (optionMarker(question, option) === 'correct') {
                        <span class="text-xs font-bold text-success uppercase tracking-wider">{{ 'results.marker_correct' | translate }}</span>
                      } @else if (optionMarker(question, option) === 'answer') {
                        <span class="text-xs font-medium text-primary uppercase tracking-wider">{{ 'results.marker_answer' | translate }}</span>
                      }
                    </div>
                  }
                </div>
              </div>
            </div>
          } @empty {
            <div class="rounded-xl border border-slate-200 dark:border-surface-highlight bg-white dark:bg-surface-dark p-6 text-center">
              <p class="text-sm text-slate-500 dark:text-slate-400">{{ 'results.no_questions_in_filter' | translate }}</p>
            </div>
          }
          <div class="h-20"></div>
        </div>
      </div>
    </main>

    <div class="fixed bottom-6 right-4 md:right-[15%] z-30 flex flex-col items-end gap-2">
      <button
        type="button"
        class="group flex items-center justify-center gap-2 bg-primary hover:bg-blue-600 text-white shadow-lg shadow-blue-900/20 rounded-full h-12 pl-4 pr-5 transition-all active:scale-95 disabled:opacity-60 disabled:cursor-not-allowed"
        [disabled]="isExporting()"
        (click)="exportPdf()"
      >
        <span class="material-symbols-outlined text-xl">picture_as_pdf</span>
        <span class="text-sm font-semibold tracking-wide">{{ isExporting() ? ('actions.exporting' | translate) : ('actions.export_pdf' | translate) }}</span>
      </button>

      @if (exportError()) {
        <p class="text-xs text-red-500 bg-white/90 dark:bg-surface-dark px-2 py-1 rounded-md">{{ exportError() }}</p>
      }
    </div>
  } @else {
    <app-empty-state
      [title]="'results.no_results_title' | translate"
      [description]="'results.no_results_desc' | translate"
      [actionLabel]="'actions.back_to_setup' | translate"
      titleClass="text-2xl font-bold text-white"
      (action)="backToSetup()"
    />
  }
</div>

