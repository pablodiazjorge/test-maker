<div
  class="bg-background-light dark:bg-background-dark font-display text-slate-900 dark:text-white antialiased min-h-screen flex flex-col overflow-hidden relative selection:bg-primary selection:text-white"
>
  @if (currentQuestion(); as question) {
    <div class="fixed top-0 left-0 w-full z-50 h-1 bg-border-dark/50">
      <div class="h-full bg-primary transition-all duration-500 ease-out shadow-[0_0_10px_rgba(19,127,236,0.5)]" [style.width.%]="progress()"></div>
    </div>

    <div class="relative z-10 flex flex-col h-full min-h-screen max-w-md mx-auto w-full pt-6">
      <div class="flex items-center justify-between px-6 pt-2 pb-2">
        <div class="text-xs font-medium text-muted-foreground tracking-wider uppercase">
          Question {{ currentIndex() + 1 }} / {{ totalQuestions() }}
        </div>
        <button
          type="button"
          class="text-xs font-medium text-white hover:text-primary transition-colors px-4 py-1.5 rounded-full bg-white/5 border border-white/10 hover:bg-white/10 active:scale-95"
          (click)="finishQuiz()"
        >
          Finish
        </button>
      </div>

      <div class="px-6 mb-2">
        <div class="relative w-full">
          <select
            class="w-full appearance-none rounded-lg border border-border-dark bg-card-dark py-2.5 pl-3 pr-10 text-sm text-white focus:border-primary focus:outline-none focus:ring-1 focus:ring-primary"
            [ngModel]="currentIndex() + 1"
            (ngModelChange)="goToQuestion($event)"
          >
            @for (item of questions(); track item.id; let i = $index) {
              <option [value]="i + 1">Question {{ i + 1 }} @if (i === currentIndex()) { (Current) }</option>
            }
          </select>
          <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-muted-foreground">
            <span class="material-symbols-outlined text-lg">unfold_more</span>
          </div>
        </div>
      </div>

      <main class="flex-1 overflow-y-auto no-scrollbar px-6 flex flex-col justify-center pb-32">
        <div class="flex flex-col gap-4 mb-10">
          <h1 class="text-3xl md:text-4xl font-bold leading-tight tracking-tight text-white">{{ question.text }}</h1>
          <p class="text-base text-muted-foreground leading-relaxed">Select the correct option to continue.</p>
        </div>

        <div class="flex flex-col gap-4 w-full">
          @for (option of question.options; track option.id; let idx = $index) {
            <button type="button" [class]="optionButtonClasses(question, option)" (click)="selectAnswer(question.id, option.id)">
              <div [class]="optionBadgeClasses(question, option)">
                @if (question.userSelectedOptionId === option.id) {
                  <span class="material-symbols-outlined text-[20px]">check</span>
                } @else {
                  {{ optionLabel(idx) }}
                }
              </div>
              <span [class]="optionTextClasses(question, option)">{{ option.text }}</span>
            </button>
          }
        </div>
      </main>

      <footer class="fixed bottom-0 left-0 right-0 z-40">
        <div class="absolute -top-16 left-0 right-0 h-16 bg-gradient-to-t from-background-dark to-transparent pointer-events-none"></div>
        <div class="bg-background-dark/95 backdrop-blur-xl border-t border-white/5 p-4 pb-8 safe-area-bottom">
          <div class="max-w-md mx-auto flex items-center gap-4">
            <button
              type="button"
              class="h-14 w-14 flex items-center justify-center rounded-2xl border border-border-dark bg-card-dark text-muted-foreground hover:text-white hover:bg-white/5 transition-all active:scale-95 disabled:opacity-40 disabled:cursor-not-allowed"
              [disabled]="currentIndex() === 0"
              (click)="goBack()"
            >
              <span class="material-symbols-outlined">arrow_back</span>
            </button>

            <button
              type="button"
              class="flex-1 flex items-center justify-center gap-2 h-14 rounded-2xl bg-primary text-white font-bold text-lg shadow-[0_0_20px_rgba(19,127,236,0.3)] transition-transform active:scale-[0.98] hover:bg-primary/90"
              (click)="continueQuiz()"
            >
              <span>{{ isLastQuestion() ? 'Finish Quiz' : 'Continue' }}</span>
              <span class="material-symbols-outlined text-[22px]">{{ isLastQuestion() ? 'check' : 'arrow_forward' }}</span>
            </button>
          </div>
        </div>
      </footer>
    </div>
  } @else {
    <main class="min-h-screen max-w-md mx-auto w-full px-6 py-12 flex flex-col items-center justify-center text-center gap-4">
      <h1 class="text-2xl font-bold text-white">No active quiz session</h1>
      <p class="text-sm text-muted-foreground">Start a new quiz from the setup dashboard.</p>
      <button
        type="button"
        class="bg-primary hover:bg-primary/90 text-white font-semibold py-3 px-5 rounded-xl transition-all"
        (click)="restart()"
      >
        Back to Setup
      </button>
    </main>
  }
</div>
