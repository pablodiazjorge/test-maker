<div
  class="bg-background-light dark:bg-background-dark font-display text-slate-900 dark:text-white antialiased min-h-screen flex flex-col overflow-hidden relative selection:bg-primary selection:text-white"
>
  @if (currentQuestion(); as question) {
    <div class="fixed top-0 left-0 w-full z-50 h-1 bg-slate-300/80 dark:bg-border-dark/50">
      <div class="h-full bg-primary transition-all duration-500 ease-out shadow-[0_0_10px_rgba(19,127,236,0.5)]" [style.width.%]="progress()"></div>
    </div>

    <div class="relative z-10 flex flex-col h-full min-h-screen max-w-md md:max-w-none mx-auto w-full md:w-[70%] pt-6">
      <div class="flex items-center justify-between px-6 pt-2 pb-2">
        <div class="text-xs font-medium text-muted-foreground tracking-wider uppercase">
          Question {{ currentIndex() + 1 }} / {{ totalQuestions() }}
        </div>
        <button
          type="button"
          class="text-xs font-medium text-slate-600 dark:text-white hover:text-primary transition-colors px-4 py-1.5 rounded-full bg-white dark:bg-white/5 border border-slate-200 dark:border-white/10 hover:bg-slate-100 dark:hover:bg-white/10 active:scale-95"
          (click)="finishQuiz()"
        >
          Finish
        </button>
      </div>

      <div class="px-6 mb-2">
        <div class="relative w-full">
          <select
            class="w-full appearance-none rounded-lg border border-slate-200 dark:border-border-dark bg-white dark:bg-card-dark py-2.5 pl-3 pr-10 text-sm text-slate-800 dark:text-white focus:border-primary focus:outline-none focus:ring-1 focus:ring-primary"
            [ngModel]="currentIndex() + 1"
            (ngModelChange)="goToQuestion($event)"
          >
            @for (item of questions(); track item.id; let i = $index) {
              <option [value]="i + 1">Question {{ i + 1 }} @if (i === currentIndex()) { (Current) }</option>
            }
          </select>
        </div>
      </div>

      <main class="flex-1 overflow-y-auto no-scrollbar px-6 pt-4 flex flex-col pb-32">
        <div class="flex flex-col gap-4 mb-8">
          <h1 class="text-lg sm:text-xl md:text-3xl font-semibold leading-snug tracking-tight text-slate-900 dark:text-white">{{ question.text }}</h1>
        </div>

        <div class="flex flex-col gap-4 w-full">
          @for (option of question.options; track option.id; let idx = $index) {
            <button
              type="button"
              [class]="optionButtonClasses(question, option)"
              (click)="selectAnswer(question.id, option.id)"
              (dblclick)="selectAndContinue(question.id, option.id)"
            >
              <div [class]="optionBadgeClasses(question, option)">
                @if (question.userSelectedOptionId === option.id) {
                  <span class="material-symbols-outlined text-[18px]">check</span>
                } @else {
                  {{ optionLabel(idx) }}
                }
              </div>
              <span [class]="optionTextClasses(question, option)">{{ option.text }}</span>
            </button>
          }
        </div>
      </main>

      <footer class="fixed bottom-0 left-0 right-0 z-40">
        <div class="absolute -top-16 left-0 right-0 h-16 bg-gradient-to-t from-background-light dark:from-background-dark to-transparent pointer-events-none"></div>
        <div class="bg-background-light/95 dark:bg-background-dark/95 backdrop-blur-xl border-t border-slate-200 dark:border-white/5 px-6 py-4 pb-8 safe-area-bottom">
          <div class="max-w-md md:max-w-none mx-auto w-full md:w-[70%] flex items-center gap-4">
            <button
              type="button"
              class="h-14 w-14 flex items-center justify-center rounded-2xl border border-slate-200 dark:border-border-dark bg-white dark:bg-card-dark text-slate-500 dark:text-muted-foreground hover:text-slate-700 dark:hover:text-white hover:bg-slate-100 dark:hover:bg-white/5 transition-all active:scale-95 disabled:opacity-40 disabled:cursor-not-allowed"
              [disabled]="currentIndex() === 0"
              (click)="goBack()"
            >
              <span class="material-symbols-outlined">arrow_back</span>
            </button>

            <button
              type="button"
              class="flex-1 flex items-center justify-center gap-2 h-14 rounded-2xl bg-primary text-white font-bold text-lg shadow-[0_0_20px_rgba(19,127,236,0.3)] transition-transform active:scale-[0.98] hover:bg-primary/90"
              (click)="continueQuiz()"
            >
              <span>{{ isLastQuestion() ? 'Finish Quiz' : 'Continue' }}</span>
              <span class="material-symbols-outlined text-[22px]">{{ isLastQuestion() ? 'check' : 'arrow_forward' }}</span>
            </button>
          </div>
        </div>
      </footer>
    </div>
  } @else {
    <app-empty-state
      title="No active quiz session"
      description="Start a new quiz from the setup dashboard."
      actionLabel="Back to Setup"
      (action)="restart()"
    />
  }
</div>



